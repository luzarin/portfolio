<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    crossorigin="anonymous">
  <link rel="stylesheet" href="../style.css">
  <link rel="stylesheet" href="../pag_proyecto.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap"
    rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;500;600;700;800&display=swap"
    rel="stylesheet">
    
  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="anonymous" />
  <title>Proyecto 5</title>

  <style>
    .project5-wrapper {
      padding-top: 90px;
      padding-bottom: 40px;
    }

    .project5-layout {
      max-width: 1400px;
      margin: 0 auto;
      display: flex;
      gap: 16px;
      align-items: flex-start;
      padding: 0 24px;
    }

    .project5-layout .map-column {
      flex: 1 1 60%;
      min-width: 0;
      display: flex;
      flex-direction: column;
      gap: 0px;
    }

    .project5-layout .map-block {
      display: flex;
      flex-direction: column;
    }

    .project5-layout .map-title {
      padding: 24px 20px 24px 4px;
      font-weight: 600;
      text-align: center;
      margin-bottom: 12px;
      color: #222;
      font-family: 'Noto Sans', sans-serif;
    }

    .project5-layout .map-container {
      width: 100%;
      border-radius: 8px;
      overflow: hidden;
      box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
      min-height: 600px;
    }

    #leafletMap1,
    #leafletMap2,
    #leafletMap3 {
      width: 100%;
      height: 100%;
      min-height: 600px;
    }

    .project5-layout .text-column {
      flex: 1 1 48%;
      min-width: 0;
      background: rgba(255, 255, 255, 0.92);
      border-radius: 12px;
      box-shadow: 0 6px 16px rgba(0, 0, 0, 0.12);
      padding: 24px 20px 24px 0px;
    }

    .project5-layout .text-column .project-text {
      width: 100%;
      margin: 0;
      text-align: left;
      max-height: none;
      overflow-y: visible;
    }

    .project5-layout .text-column .project-text .project5-paragraph {
      margin: 0.6rem 0;
      text-align: justify;
    }

    .project5-layout .text-column .project-text .project5-paragraph:first-of-type {
      margin-top: 0.85rem;
    }

    .project5-legend {
      background: rgba(255, 255, 255, 0.95);
      padding: 10px 12px;
      border-radius: 8px;
      box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
      border: 1px solid #ccc;
      min-width: 120px;
      font: 13px/16px Arial, Helvetica, sans-serif;
      color: #555;
    }

    .project5-legend .legend-title {
      font-weight: 700;
      margin-bottom: 6px;
      text-align: center;
      color: #333;
    }

    .project5-legend .legend-item {
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 4px;
      font-size: 12px;
    }

    .project5-legend .legend-color {
      width: 20px;
      height: 20px;
      border-radius: 2px;
      border: 1px solid #999;
      flex-shrink: 0;
    }

    .project5-legend .legend-label {
      font-variant-numeric: tabular-nums;
      font-feature-settings: 'tnum' 1;
      min-width: 48px;
      text-align: left;
    }

    @media screen and (max-width: 992px) {
      .project5-layout {
        flex-direction: column;
      }

      .project5-layout .map-container,
      #leafletMap1,
      #leafletMap2,
      #leafletMap3 {
        min-height: 420px;
      }
    }
  </style>
</head>

<body>
  <nav class="nav">
    <div class="container">
      <div class="logo">
        <a href="../index.html">Inicio</a>
      </div>
      <div id="mainListDiv" class="main_list">
        <ul class="navlinks">
          <li><a href="Lucas-Blachet-DelSolar-CV.pdf">CV</a></li>
          <li><a href="http://www.linkedin.com/in/lucas-blachet/">LinkedIn</a></li>
          <li><a href="https://github.com/luzarin">GitHub</a></li>
        </ul>
      </div>
      <button id="mobileMenuButton" class="mobile-menu-btn" aria-label="Abrir men√∫">‚ò∞</button>
      <div id="mobileMenu" class="mobile-menu" style="display:none;">
        <ul>
          <li><a href="Lucas-Blachet-DelSolar-CV.pdf">CV</a></li>
          <li><a href="http://www.linkedin.com/in/lucas-blachet/">LinkedIn</a></li>
          <li><a href="https://github.com/luzarin">GitHub</a></li>
        </ul>
      </div>
    </div>
  </nav>

  <div class="project5-wrapper">
    <div class="project5-layout">
      <div class="map-column">
        <div class="map-block">
          <div class="map-title">Temperatura Superficial (LST)</div>
          <div class="map-container">
            <div id="leafletMap1"></div>
          </div>
        </div>
        <div class="map-block">
          <div class="map-title">Isla de Calor Urbana (UHI)</div>
          <div class="map-container">
            <div id="leafletMap2"></div>
          </div>
        </div>
        <div class="map-block">
          <div class="map-title">√çndice de Varianza del Campo T√©rmico (UTFVI)</div>
          <div class="map-container">
            <div id="leafletMap3"></div>
          </div>
        </div>
      </div>

      <div class="text-column">
        <div class="card-text project-text">
          <span class="coll projdes">Resumen del Proyecto</span>
          <p class="project5-paragraph">Para elaborar este proyecto se utiliz√≥ como metodolog√≠a el paper "Leveraging
            cloud-based computing and spatial modeling approaches for land surface temperature disparities in response
            to land cover change" de Waleed y Sajjad (2022).</p>
          <p class="project5-paragraph">Primero, se carg√≥ el √°rea de estudio desde un asset y se estableci√≥ el rango
            temporal para el verano del hemisferio sur 2024-2025.</p>
          <p class="project5-paragraph">Segundo, se establecieron dos funciones de preprocesamiento, siendo la primera
            la que aplica los factores de escala de Landsat 8, transformando las bandas √≥pticas a reflectancia f√≠sica y
            las t√©rmicas a temperatura de brillo en Kelvin mediante los multiplicadores y offsets provistos por el
            dataset. La segunda funci√≥n gener√≥ la m√°scara de nubes/sombras mediante la interpretaci√≥n bit a bit de la
            banda QA_PIXEL, manteniendo solamente los p√≠xeles despejados. Estas funciones permiten transformar los
            valores digitales (DN) crudos en datos f√≠sicamente consistentes y sin nubes/sombras.</p>
          <p class="project5-paragraph">Tercero, se construy√≥ el mosaico de trabajo, donde se filtr√≥ la colecci√≥n de
            Landsat 8 por geometr√≠a y fecha, se aplicaron las funciones de escala y m√°scara a cada escena y luego se
            tom√≥ la mediana temporal para obtener una imagen representativa. El resultado se recort√≥ al pol√≠gono de la
            Regi√≥n Metropolitana al ser esta el √°rea de an√°lisis.</p>
          <p class="project5-paragraph">Cuarto, con la imagen procesada se calcul√≥ el NDVI a partir de las bandas de
            reflectancia superficial, y de la cual se obtuvieron dos par√°metros biof√≠sicos esenciales: la proporci√≥n de
            vegetaci√≥n (Pv = (NDVImax ‚àí NDVImin / NDVI ‚àí NDVImin)¬≤; normalizada 0-1 y utilizando los valores min-max del
            NDVI de toda la RM) y la emisividad superficial (Œµ=0.986+0.004Pv), derivada mediante una relaci√≥n lineal
            estandarizada. Luego, se extrajo la banda t√©rmica reescalada y se aplic√≥ una correcci√≥n atmosf√©rica
            simplificada para convertir la temperatura de brillo en temperatura superficial (LST) en grados Celsius,
            integrando la emisividad en el c√°lculo.</p>
          <p class="project5-paragraph">Una vez obtenido el LST, se extrajeron estad√≠sticas descriptivas sobre la RM:
            media, desviaci√≥n est√°ndar, valores extremos y percentiles. Estas estad√≠sticas permitieron construir √≠ndices
            derivados. El Urban Heat Island (UHI) se defini√≥ como la estandarizaci√≥n de la LST respecto a la media
            regional, expresada en desviaciones est√°ndar, lo cual permite identificar p√≠xeles relativamente m√°s
            c√°lidos/m√°s fr√≠os que el entorno. El Urban Thermal Field Variance Index (UTFVI) se defini√≥ como la
            desviaci√≥n relativa del LST respecto a la media, normalizada por el propio valor de LST, indicador usado
            frecuentemente para evaluar la variabilidad t√©rmica urbana con √©nfasis en el riesgo ambiental.</p>
          <p class="project5-paragraph">Cada uno de estos tres productos (LST, UHI y UTFVI) se visualiz√≥ con paletas
            t√©rmicas apropiadas y posteriormente se configur√≥ su exportaci√≥n a Google Drive en formato GeoTIFF con
            proyecci√≥n UTM 19S (EPSG: 5361) y de 30m de resoluci√≥n.</p>
          <p class="project5-paragraph">Finalmente, se generaron visualizaciones anal√≠ticas en la consola: histogramas
            que muestran la distribuci√≥n de LST y UHI en la RM, y un diagrama de dispersi√≥n NDVI‚ÄìLST construido a partir
            de una muestra aleatoria de p√≠xeles, el cual permite observar la relaci√≥n inversa t√≠pica entre vegetaci√≥n y
            temperatura superficial, reforzando la interpretaci√≥n ecol√≥gica del modelo t√©rmico desarrollado.</p>
          <span class="coll projdes" style="margin-top: 1.8rem; display:block;">M√°s Informaci√≥n</span>
          <a href="https://github.com/luzarin/LST-UHI-UTFVI-Landsat8"
            style="display:inline-block; margin: 0.5rem 0 1.5rem;">
            <span class="logos">üîó GitHub</span>
          </a>
        </div>
      </div>
    </div>
  </div>

  <!-- Leaflet JavaScript -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
    integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
  <script src="https://unpkg.com/georaster@1.6.0/dist/georaster.browser.bundle.min.js"></script>
  <script src="https://unpkg.com/georaster-layer-for-leaflet@3.10.0/dist/georaster-layer-for-leaflet.min.js"></script>

  <script>
    function createLeafletMap(targetId, center, zoom) {
      var map = L.map(targetId, {
        zoomControl: true,
        scrollWheelZoom: true
      }).setView(center, zoom);

      L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
        attribution: '¬© OpenStreetMap contributors ¬© CARTO',
        maxZoom: 19
      }).addTo(map);

      return map;
    }

    function hexToRgb(hex) {
      var clean = hex.startsWith('#') ? hex.slice(1) : hex;
      if (clean.length === 3) {
        clean = clean.split('').map(function (c) { return c + c; }).join('');
      }
      var num = parseInt(clean, 16);
      return {
        r: (num >> 16) & 255,
        g: (num >> 8) & 255,
        b: num & 255
      };
    }

    function interpolateColor(start, end, t) {
      return {
        r: Math.round(start.r + (end.r - start.r) * t),
        g: Math.round(start.g + (end.g - start.g) * t),
        b: Math.round(start.b + (end.b - start.b) * t)
      };
    }

    function buildColorRamp(min, max, palette) {
      var rgbPalette = palette.map(hexToRgb);
      return function (value) {
        if (value === null || value === undefined || Number.isNaN(value)) {
          return null;
        }
        var clamped = Math.max(min, Math.min(max, value));
        var normalized = (clamped - min) / (max - min);
        if (!Number.isFinite(normalized)) {
          return null;
        }
        var scaled = normalized * (rgbPalette.length - 1);
        var index = Math.floor(scaled);
        if (index >= rgbPalette.length - 1) {
          index = rgbPalette.length - 2;
          scaled = rgbPalette.length - 1;
        }
        var t = scaled - index;
        var mixed = interpolateColor(rgbPalette[index], rgbPalette[index + 1], t);
        return 'rgb(' + mixed.r + ',' + mixed.g + ',' + mixed.b + ')';
      };
    }

    function addGeoTiffLayer(map, config) {
      fetch(config.url)
        .then(function (response) {
          if (!response.ok) {
            throw new Error('No se pudo cargar ' + config.url);
          }
          return response.arrayBuffer();
        })
        .then(parseGeoraster)
        .then(function (georaster) {
          var colorFn = buildColorRamp(config.min, config.max, config.palette);
          var layer = new GeoRasterLayer({
            georaster: georaster,
            resolution: 256,
            opacity: 0.9,
            pixelValuesToColorFn: function (values) {
              var value = values && values.length ? values[0] : null;
              if (value === georaster.noDataValue) {
                return null;
              }
              return colorFn(value);
            }
          });
          layer.addTo(map);
          if (config.fitToBounds) {
            try {
              map.fitBounds(layer.getBounds(), { padding: [20, 20] });
            } catch (error) {
              console.warn('No fue posible ajustar el mapa al r√°ster:', error);
            }
          } else if (config.center || typeof config.zoom === 'number') {
            var targetCenter = config.center || map.getCenter();
            var targetZoom = typeof config.zoom === 'number' ? config.zoom : map.getZoom();
            map.setView(targetCenter, targetZoom);
          }
        })
        .catch(function (error) {
          console.error('Error al cargar el r√°ster', config.url, error);
        });
    }

    function createLegendControl(map, config) {
      var legend = L.control({ position: 'bottomleft' });
      legend.onAdd = function () {
        var div = L.DomUtil.create('div', 'project5-legend');
        var title = config.legendTitle || 'Leyenda';
        div.innerHTML = '<div class="legend-title">' + title + '</div>';
        var steps = Math.max(1, config.palette.length - 1);
        var entries = config.palette.map(function (color, index) {
          var value;
          if (index === config.palette.length - 1) {
            value = config.max;
          } else {
            value = config.min + ((config.max - config.min) / steps) * index;
          }
          var formatted = config.legendFormatter ? config.legendFormatter(value, index) : value.toFixed(1);
          return { color: color, label: formatted };
        });

        entries.forEach(function (entry) {
          var item = L.DomUtil.create('div', 'legend-item', div);
          var colorBox = L.DomUtil.create('span', 'legend-color', item);
          colorBox.style.background = entry.color;
          var label = L.DomUtil.create('span', 'legend-label', item);
          label.textContent = entry.label;
        });

        return div;
      };
      legend.addTo(map);
    }

    document.addEventListener('DOMContentLoaded', function () {
      var defaultCenter = [-33.605828, -70.709793];
      var rasterConfigs = [
        {
          elementId: 'leafletMap1',
          url: './proyecto 5/LST_RM.tif',
          min: 10,
          max: 45,
          palette: ['#313695', '#4575b4', '#74add1', '#abd9e9', '#e0f3f8', '#ffffbf', '#fee090', '#fdae61', '#f46d43', '#d73027', '#a50026'],
          legendTitle: 'LST (¬∞C)',
          legendFormatter: function (value) { return value.toFixed(1) + ' ¬∞C'; },
          zoom: 9,
          center: defaultCenter
        },
        {
          elementId: 'leafletMap2',
          url: './proyecto 5/UHI_RM.tif',
          min: -3,
          max: 3,
          palette: ['#313695', '#4575b4', '#abd9e9', '#ffffbf', '#fdae61', '#f46d43', '#d73027'],
          legendTitle: 'UHI (œÉ)',
          legendFormatter: function (value) { return value.toFixed(1) + ' œÉ'; },
          zoom: 9,
          center: defaultCenter
        },
        {
          elementId: 'leafletMap3',
          url: './proyecto 5/UTFVI_RM.tif',
          min: -3,
          max: 3,
          palette: ['#313695', '#74add1', '#fed976', '#feb24c', '#fd8d3c', '#fc4e2a', '#e31a1c', '#b10026'],
          legendTitle: 'UTFVI',
          legendFormatter: function (value) { return value.toFixed(1); },
          zoom: 9,
          center: defaultCenter
        }
      ];

      rasterConfigs.forEach(function (cfg) {
        var initialCenter = cfg.center || [-33.575577, -70.704762];
        var map = createLeafletMap(cfg.elementId, initialCenter, cfg.zoom || 10);
        addGeoTiffLayer(map, cfg);
        createLegendControl(map, cfg);
      });
    });
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"
    crossorigin="anonymous"></script>
  <script src="https://kit.fontawesome.com/8edb919db8.js" crossorigin="anonymous"></script>
  <script src="../pag_proyecto.js" defer="defer"></script>

  <!-- Footer -->
  <footer style="background-color: #111111; padding: 20px 0; text-align: center; margin-top: 40px;">
    <p style="margin: 0; color: #ffffff; font-size: 0.95em;">
      Creado por Lucas Blachet Del Solar | Email: lucas.blachet@uc.cl
    </p>
  </footer>
</body>

</html>